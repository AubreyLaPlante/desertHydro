---
title: "watershedWorkflow"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{watershedWorkflow}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  progress = FALSE
  
)
```

<!-- $$(K_{macro} -  K_{FieldCond}) {\frac{W_{surf}-Field_{cap}}{d_{soil}}} ({\frac{Sat_{mc} - Field_{cap}}{d_{soil} + K_{FieldCond}}})^{-1}$$ -->
<!-- $${\frac{W_{surf}-Field_{cap}}{d_{soil}}}$$ -->
<!-- $$ {\frac{Sat_{mc} - Field_{cap}}{d_{soil} + K_{FieldCond}}$$ -->
```{r setup}
library(desertHydro) # loads installed version not vignette version
library(terra)
library(ggplot2)
# Only use other packages that are already required

```

```{r, echo = F, results='hide'}
# Important steps
# Location or file path to save the 

# # # ModelFolder <- r"(~TestFolderPackage)"

#WatershedElements <- "../inst/extdata/DemoElements" # Moves out a level to get to data folder
# File names
ModelFolder <- r"(C:\Thesis\Arid-Land-Hydrology\Data\Waterhole\Outputs\All\Mini\test)"

#ModelFolder <- r"(C:\Desktop\ModelTestFolder)" 
#WatershedElements <- r"(C:\PackageDev\desertHydro\inst\extdata\DemoElements)"
WatershedElements <- r"(C:\Thesis\Arid-Land-Hydrology\R\Example\MiniWatershedElements)"
date <- NULL
demFile <- "cropped_dem.tif" # Necessary
boundary <- "mini_ws.shp" # Optional
landCoverFile <- "land_cover_soils.shp"
LandCoverCharacteristics <- "LandCoverCharacteristics_soils.xlsx"
key <- "MUSYM"
rainFile <- "USGS_Rain_2001_2021.xlsx"
dischargeFile <- "example_discharge.csv"
rainfall_method <- "Synthetic"
length <- 10
discharge = F
store = T
time_step <- 0.25
simulation_length <- 10

# flowDirectionMap <- flowStack
# n <- SoilStack$mannings_n
# depth <- SoilStack$surfaceWater + .01 *2.54
# slope <- SoilStack$slope

# # # print("Check for vignette!")
a <- arid_model(ModelFolder,
                WatershedElements,
                date = NULL,
                demFile = demFile,
                boundary = boundary,
                landCoverFile = landCoverFile,
                LandCoverCharacteristics = LandCoverCharacteristics,
                key = key,
                impervious = T,
                rainfall_method = rainfall_method,
                store = T,
                gif = F,
                discharge = discharge,
                time_step = time_step,
                simulation_length = simulation_length,
                overwrite = T,
                write = T,
                restartModel = F
                )

# SoilStack <- terra::rast(file.path(ModelFolder, "model_soil_stack.tif"))
# tempStack <- terra::rast(file.path(ModelFolder, "tempStorage.tif"))
# flowStack <- terra::rast(file.path(ModelFolder, "stack_flow.tif"))
# flowStackPost <- terra::rast(file.path(ModelFolder, "AdjustedFlowStack.tif"))


# s <- terra::rast(rasterCompile(ModelFolder, "surface"))
# v <- terra::rast(rasterCompile(ModelFolder, "velocity"))
# SoilStack <- terra::rast(file.path(ModelFolder, "model_soil_stack.tif"))
# terra::plot(SoilStack)
# getwd()
```

# Load in the Gif files
```{r, animation.hook='gifski'}

# Rain file to grab the necessary rainfall method
rain_file <- desertHydro:::rainfallMethodCheck(ModelFolder, rainfall_method)
gifs <- desertHydro:::gifCreation(ModelFolder, rain_file = rain_file, discharge = F, saveGraph = T)

gifs[[1]] # surface gif
gifs[[2]] # velocity gif



```

